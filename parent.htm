<!DOCTYPE html>

<script src="./dist/post-robot.ie.min.js"></script>
<button onclick="openWindow()">open</button>
<div id="messages"></div>

<script>
    var callback = Math.random().toString().replace(/[^a-z0-9]+/g, '');
    var openedWindow;
    postRobot.bridge.openBridge('https://identity.developers.kp.house/identity/api/1/auth/bridge.xml', 'https://identity.developers.kp.house');
	function openWindow() {
		openedWindow = window.open('https://identity.developers.kp.house/identity/api/1/auth/uid.xml?callback=tmp' + callback, callback);
	}
	postRobot.on('tmp' + callback, function(event) {
		var el = document.getElementById('messages');
		el.innerHTML += '\n' + event.data.message.uid + ' ' + event.data.message.access_token;
		openedWindow.close();
		return {
			message: event.data.message
		}
	});
</script>
